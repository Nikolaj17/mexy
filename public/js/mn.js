var _typeof="function"===typeof Symbol&&"symbol"===typeof Symbol.iterator?function(O){return typeof O}:function(O){return O&&"function"===typeof Symbol&&O.constructor===Symbol&&O!==Symbol.prototype?"symbol":typeof O};
DC.ready(function(){function O(){console.log.apply(console,arguments)}function va(){var b=location.search.substr(1),b=b.split("&"),c={},a;b.map(function(b){a=b.split("=");2==a.length&&(c[a[0]]=a[1])});return c}function U(b,c){var a;aa||(aa=b);"undefined"==typeof c&&window.history.pushState(null,null,b);ba.stop();if(ca.notlast()){if((a=ca(aa))&&a.onleave)a.onleave();aa=b;r.close()}""==b&&(b="/");if(ma)if(s.authorized)if(f=b,"/"==f)U(La);else if(a=ca(f)){L.activate(f);var g=[];"im"==f?(f=a.title(),
F||r.check()):f=a.title;f?(na.h=f,na.el.show(),g.push(na)):na.el.hide();g.push(a);I.DClist(g);F&&r.adapt()}else I.t="",H.until("undefined...");else{var f=b;I.t="";switch(f){case "/":L.activate(f);I.DClist([Ma.init()]);break;case "about":L.activate(f);I.DClist([za.init()]);break;default:U("/")}}else n.show()}function oa(){ca||(ca=function(){var b={contacts:Na,im:Oa,sc:Pa,settings:Aa,about:za},c=function(c){return(c=b[c])?c.init():!1},a;c.notlast=function(){var b=location.href,c=a!=b;a=b;return c};
c.notlast();return c}());U(location.pathname.substr(1),0);L.init();da()}function a(){return DC.temp.apply(null,arguments)}function pa(){return DC.emit.apply(null,arguments)}function Qa(b,c){b.err||b.reason?H.is(b.err||b.reason):b[0]?c(b):H.is(b)}function y(){ma&&Ba()&&(Ba.inc(),v.emit.apply(v,arguments))}function Ca(b){b?(n.show("authorizing..."),setTimeout(function(){y("auth",{token:b},function(c){if(c[0]&&c.id){R.token=b;s.authorized=1;s.id=c.id;c.name&&(s.name=c.name);if(c.settings){var a={};c.settings.forEach(function(b){a[b.prop]=
b.val});s.settings=a;a.theme&&(s.css.theme=a.theme,da(a.theme,1))}Ra();y("get_my_userdata")}else delete R.token;oa();n.hide();DC.emit("u_login")})})):R.token?Ca(R.token):(n.show("processing data..."),setTimeout(function(){oa();n.hide();DC.emit("u_login")}))}function da(b,c){b?s.css.theme=b:s.css.theme||(s.css.theme="black_white_mn");Aa.theme.set(s.css.theme,c)}function qa(b){var c=!1;/^(([^<>()\[\]\.,;:\s@\"]+(\.[^<>()\[\]\.,;:\s@\"]+)*)|(\".+\"))@(([^<>()[\]\.,;:\s@\"]+\.)+[^<>()[\]\.,;:\s@\"]{2,})$/i.test(b)&&
(c=!0);return c}function N(b){b.removeClass("pulse_once");b.pulsetimeout&&(clearTimeout(b.pulsetimeout),b.pulsetimeout=0);b.pulsetimeout2&&(clearTimeout(b.pulsetimeout2),b.pulsetimeout2=0);b.pulsetimeout=setTimeout(function(){b.pulsetimeout=0;b.addClass("pulse_once");b.pulsetimeout2=setTimeout(function(){b.removeClass("pulse_once")},Sa)},15)}function q(b){b&&b.preventDefault()}function Da(){F?(I.el.css({"min-height":""}),I.el.css({height:window.innerHeight-38})):(I.el.css({"min-height":window.innerHeight-
38}),I.el.css({height:"auto"}));L.position()}function ea(b){if(null==b||"object"!=("undefined"===typeof b?"undefined":_typeof(b)))return b;var c=b.constructor(),a;for(a in b)b.hasOwnProperty(a)&&(c[a]=ea(b[a]));return c}function fa(b,c){if(s.sertd){c?10==(c+"").length&&(c*=1E3):c=Date.now();var a=c-s.sertd;b&&(a=Math.round(a/1E3));return a}return c?c:Date.now()}function Ea(b){var c=new Date(fa(0,b));b=""+c.getHours();1==b.length&&(b="0"+b);c=""+c.getMinutes();1==c.length&&(c="0"+c);return b+":"+c}
function Ta(b){var c=new Date(fa(0,b));(""+c.getFullYear()).substr(2,3);c=""+c.getDate()+" ";b=new Date(fa(0,b));b=""+(b.getMonth()+1);switch(b){case "1":b="Jan";break;case "2":b="Feb";break;case "3":b="Mar";break;case "4":b="Apr";break;case "5":b="May";break;case "6":b="Jun";break;case "7":b="Jul";break;case "8":b="Aug";break;case "9":b="Sep";break;case "10":b="Oct";break;case "11":b="Nov";break;case "12":b="Dec"}return c+b}function V(b){var c=s.id;return b?c==b?!0:!1:c}function Ua(b){var c=a(),
k=b._id,g={},f=g.pic=a({state:{"class":"u_picture_mid"}}),d='<div class="back_line">{pic}</div>';b.userdata&&b.userdata.crop_photo&&f.el.css({"background-image":"url("+S(b.userdata.crop_photo)+")"});b.star&&(d+='<div class="star_friend"></div>');var h=Va(k);c.timer=g.t=h;c.update=function(){b=B(k);b.userdata.crop_photo&&f.el.css({"background-image":"url("+S(b.userdata.crop_photo)+")"});h.tick()};ra(k,c.update);d+='<div class="inlb" style="vertical-align:top;padding-right: 5px;"><div class="inlb">'+
b.name+'</div><div class="inlb padl5">{t}</div><br />';g.bt=a({eltype:"button",state:{"class":"b",text:"talk"},events:{click:function(){wa(k)}}});d+="{bt}</div></div>";return c.parse(d,g)}function wa(b,c){y("conv",{act:"start",target:b},function(a){a.ok&&("undefined"==typeof c&&window.history.pushState(null,null,"/im?cid="+a.ok.cid),r.start({target:b,cid:a.ok.cid},1))})}function Wa(b,a){if(!b)return console.log("cid undefined");y("conv",{act:"get",cid:b},function(b){b.ok?a(0,b.ok.target):a("error")})}
function Fa(){H.long("You don't have access");U(location.pathname.substr(1))}function Ra(){v.on("newm",function(b){r.received(b)});v.on("viewedm",function(b){r.viewed(b)});v.on("typing",function(b){r.typing(b)});v.on("contact_online",function(b){B.online(b.uid,1);pa("contacts")});v.on("contact_offline",function(b){B.online(b.uid,0);pa("contacts")});v.on("userdata",function(b){for(var a in b)s.userdata[a]=b[a];pa("u_data")});v.on("push",function(b){})}DC.setPseudo(["u_login","tab_active","contacts",
"u_data"]);var s={authorized:0,css:{},userdata:{}},Ga,B=function(){var b={},a={},k={},g=function d(a,c,x){var g=b[a];if(!g)return c||x?d.load(a,c,x):!1;g=ea(g);if(c&&x)x(g);else return g};g.updateData=function(a,c){var l=b[a];if(l){for(var g in c)l.userdata[g]=c[g];ra.emit(a)}};g.add=function(d,h){h.online=h.online||1==a[d];h.wasOnline=h.online;var l=b[d];if(l)for(var g in h)l[g]=h[g];else l=b[d]=h;l.userdata||(l.userdata={});1==h.status&&(k[d]=h)};g.load=function(b,a,c){y("user",{act:"get_info",
uid:b},function(x){x.ok?(g.add(b,x.ok),c()):a()})};g.online=function(d,h){a[d]=h?1:0;var l=b[d];l&&(l.online=1==h,l.online||l.online==l.wasOnline||(l.last_v=(new Date).toISOString()),l.wasOnline=l.online)};g.getFriends=function(){return k};g.isOnline=function(b){return 1==a[b]};return g}(),R=localStorage,La="contacts",aa,J={},v,ma=0,Ba=function(){var b=0;setInterval(function(){b-=170;0>b&&(b=0)},1E4);var a=function(){var a=170>b;a||console.log("request limit exceeded");return a};a.inc=function(){b++};
return a}(),Sa=150,F,ga,sa,ta,Ha=a({eltype:"link",attrs:{rel:"stylesheet"},init:function(){this.insertIn("head")}}),I=a({init:function(){this.insertAs(".body")}}),ha=document.body,S=function(){return function(b){return"https://res.cloudinary.com/mexy-pro/image/upload/"+b}}(),ra=function(){var b={},a=[],k=function(a,c){var d=b[a];d||(d=b[a]=[]);d.push(c)};k.any=function(b){a.push(b)};k.emit=function(g){a.forEach(function(b){return b()});(g=b[g])&&g.forEach(function(b){return b()})};return k}(),na=
a({state:{"class":"route_title"}}),ca,Va=function(b){function c(){g=B(b);k&&clearTimeout(k);var a;g&&g.online?a="on":(a=g.last_v||0)&&"on"!=a&&(a=(new Date(a)).getTime());if("on"==a)a="online";else if(a){var l=fa();a=Math.round((l-a)/1E3);2>a?(a="online",k=setTimeout(c,1E3)):86400<=a?(a=Math.round(10*a/86400)/10,a=100>a?a+" d ago":"offline"):3600<=a?(a=Math.round(10*a/3600)/10,a+=" h ago",k=setTimeout(c,36E4)):60<=a?(a=Math.round(a/=60),a+=" min ago",k=setTimeout(c,6E4)):(a+=" sec ago",k=setTimeout(c,
1E3))}else a="offline";a!=f&&(f=a,"online"==f?d.addClass("last_v_on"):d.removeClass("last_v_on"));d.t=a}var k,g,f,d=a({eltype:"span",state:{"class":"last_v"},events:{contacts:function(){c()}}});d.stop=function(){k&&clearTimeout(k)};d.tick=c;d.render();c();return d},ia=function(){var b,a,k={hidden:"visibilitychange",webkitHidden:"webkitvisibilitychange",mozHidden:"mozvisibilitychange",msHidden:"msvisibilitychange"};for(b in k)if(b in document){a=k[b];break}return function(g){g&&document.addEventListener(a,
g);return!document[b]}}(),Ia=function(){var b,a,k,g=$("#favicon");return function(){DC.emit("tab_active");ia()?(document.title="MEXY.PRO",g.attr({href:"/img/favicon.png?"})):(b?(k="2",a="hey, listen"):(k="",a="you are not here"),b=!b,document.title=a,g.attr({href:"/img/favicon_message"+k+".png?"}))}}(),n=a(function(){var b=a({init:function(){this.insertAs("#loading_back")}}),c,k=a({attrs:{style:"background: none;","class":"loading_div"}}),g=a({eltype:"span",state:{"class":"loading_ball"}}),f=a({eltype:"span"}),
d=a({attrs:{"class":"loading_text"}});return{extend:{hide:function(){this.el.hide();b.el.hide();this.busy=!1;k.clearIntervals()},show:function(a){a?(d.el.show(),d.t=a):d.el.hide();this.el.show();b.el.show();this.busy||(this.busy=!0)},busy:!0},init:function(){c=this;this.insertAs("#loading").t="";k.DClist([g,f]);k.insertIn(c);d.insertIn(c)}}}),ba=a(function(){var b=1,c=a(),k=function(){function g(){if(b){var a=c.el.crec().width,h=a;window.innerHeight<a&&(a=h=window.innerHeight);if(h){var z,u,w,p,X,
C,T=a>h?h/2.75:a/2.75,Xa=0.0015*T,ua=T/5,Ya=G.ci,Y=G.length,n=a/2,Z=h/2;p=window.devicePixelRatio||1;C=m.webkitBackingStorePixelRatio||m.mozBackingStorePixelRatio||m.msBackingStorePixelRatio||m.oBackingStorePixelRatio||m.backingStorePixelRatio||1;var A=p/C;p!==C?(p=a,C=h,t.width=p*A,t.height=C*A,t.style.width=p+"px",t.style.height=C+"px",m.scale(A,A)):(t.width=a,t.height=h);ka!=t.width&&(ka=t.width);m.beginPath();m.arc(n,Z,T,0,s);m.fillStyle="rgba(255, 255, 255,.75)";m.fill();k&&(w=l,w>a/2&&(w=a/
2),m.drawImage(x,n-w/2,Z-w/2,w,w));m.save();m.lineWidth=1;for(C=0;C<E.all.length;C++)if(A=E.all[C])m.beginPath(),m.arc(A.cx,A.cy,A.r*A.s,0,s),p=1-(A.s-A.min)/(A.max-A.min),m.strokeStyle="rgba(70,70,70,"+p+")",m.stroke(),A.s+=A.sk,A.s>A.max&&(E.all[C]=!1);m.restore();for(A=0;A<G.size;A++){G.all[A]||(G.all[A]={arr:[],last:!1});z=G.all[A];C=z.arr;p=z.last;p||(z.last=p={vr:100,imin:5,imax:15},p.vx=d(-p.vr,p.vr)/p.vr+0.1,p.vy=d(-p.vr,p.vr)/p.vr+0.1,p.x=f(0,a),p.y=f(0,h),p.i=f(p.imin,p.imax));p.sx=f(ua/
10,ua);p.sy=f(ua/10,ua);w={x:p.vx*p.sx,y:p.vy*p.sy};z=p.x+w.x;u=p.y+w.y;Math.sqrt((z-n)*(z-n)+(u-Z)*(u-Z))>T&&(w={x:z-n,y:Z-u},w.a2=Math.atan2(w.x,w.y),z=n+T*Math.cos(w.a2-Math.PI/2),u=Z+T*Math.sin(w.a2-Math.PI/2),p.vx=-p.vx,p.vy=-p.vy,w=T/50,E.all[E.now]={cx:z,cy:u,r:w,min:1,max:3*w||1.2,s:1,sk:w/10||0.01},E.now++,E.now>=E.max&&(E.now=0));p.x=z;p.y=u;p.i--;p.i<p.imin&&(p.vx=d(-p.vr,p.vr)/p.vr+0.1,p.vy=d(-p.vr,p.vr)/p.vr+0.1,p.i=f(p.imin,p.imax));C[G.ci]={x:z,y:u};z=[];if(1<C.length)for(p=[],u=Ya;0<=
u;u--)p.push(C[u]),z.push([u,C[u].x]),0==u?u=C.length:u==C.length&&(u=-1),p.length>=C.length&&(u=-1);else p=C;m.lineCap="round";m.lineWidth=5;for(C=0;C<Y;C++)if(u=p[C],X=p[C+1]){0==A?m.fillStyle="rgba(0, 0, 0, "+(1-C/Y)+")":1==A?m.fillStyle="rgba(235, 0, 0, "+(1-C/Y)+")":2==A?m.fillStyle="rgba(15, 135, 235, "+(1-C/Y)+")":3==A&&(m.fillStyle="rgba(100, 100, 250, "+(1-C/Y)+")");var y=C*Xa;1>y&&(y=1);z=u.x;u=u.y;w=X.x;X=X.y;var r=y,q=Math.atan2(w-z,X-u);m.beginPath();var B=Q-q;m.arc(z,u,r,B,Math.PI+B);
m.arc(w,X,y,-q,Math.PI-q);m.closePath();m.fill()}}G.ci++;G.ci==Y&&(G.ci=0)}K&&clearTimeout(K);K=setTimeout(g,la)}}function f(a,b){return Math.floor(Math.random()*(b+1-a))+a}function d(a,b){return f(0,1)?f(1,b):f(a,-1)}var h=a({eltype:"canvas",attrs:{style:"top:0;left:0;"}}),l=200,x=new Image(l,l);x.src="/img/logo.png";var k=0;x.onload=function(){k=1};h.insertIn(c);c.el.css({margin:"0 auto",overflow:"hidden",position:"relative"});var t=h.el,m=t.getContext("2d"),G={ci:0,all:[],length:21,size:4},E={all:[],
now:0,max:3*G.size},K=0,Q=180/(180/Math.PI),s=2*Math.PI,la=17,ka;return{run:function(){b=1;g()},stop:function(){b=0}}}();return{extend:{run:function(a,b){a&&c.insertIn(a);k.run();b||(b={});var d=b.sz;d||(d=500);c.el.css({"max-width":d})},stop:function(){b&&k.stop()}},init:function(){this.el=c.el}}}),xa=a({init:function(){this.insertIn(".head")}}),ya=a(function(){var b,c={},k,g=c.pic=a({attrs:{"class":"u_picture_mini"},extend:{set:function(a){if(0==a)return this.el.style.backgroundImage=null;this.el.css({"background-image":"url("+
a+")"})}}}),f=c.nm=a({attrs:{"class":"interlocutor_name"}}),d=c.on=a({attrs:{"class":"is_interlocutor_online"}}),h;return{state:{opened:!1},events:{contacts:function(){if(F)b.online()}},extend:{hide:function(){b.el.hide();h&&(clearTimeout(h),h=0)},show:function(){b.el.show()},online:function(){h&&(clearTimeout(h),h=0);var a;(a=B(k))&&a.online?a="on":(a=a.last_v||0)&&"on"!=a&&(a=(new Date(a)).getTime());if("on"==a)a="online";else if(a){var c=fa();a=Math.round((c-a)/1E3);2>a?(a="online",h=setTimeout(b.online,
1E3)):86400<=a?(a=Math.round(10*a/86400)/10,a=100>a?a+" d ago":"offline"):3600<=a?(a=Math.round(10*a/3600)/10,a+=" h ago",h=setTimeout(b.online,36E4)):60<=a?(a=Math.round(a/=60),a+=" min ago",h=setTimeout(b.online,6E4)):(a+=" sec ago",h=setTimeout(b.online,1E3))}else a="offline";d.t=a},draw:function(a){if(F){if(a)k=a;else{if(!k)return console.log("header interlocutor error");a=k}g.set(0);var c=B(a);c?(f.t=c.name,c.userdata&&c.userdata.crop_photo&&g.set(S(c.userdata.crop_photo)),b.show(),b.online()):
(B.load(a,function(b){console.log("user not found",a)},function(c){b.draw(a)}),f.t="loading . . .")}else k=!1,b.hide()}},init:function(){b=this;ra.any(function(){b.draw()});this.parse('<div class="is_online">\n{pic}\n<div class="inlb" style="position:relative;vertical-align: top;">\n{nm}{on}\n</div>\n</div>',c).insertIn(xa)}}}),Za=a(function(){return{getSelf:function(a){},eltype:"a",state:{"class":"b",text:"logout"},attrs:{href:"/logout",id:"logout"},
events:{click:function(a){v.disconnect();delete R.token;R.clear();location.href="/"}}}}),L=a(function(){function b(b){return a(function(){var a;return{getSelf:function(b){a=b},eltype:"a",state:{"class":"back_line menu_a",page:b.p,text:b.t?b.t:b.p},attrs:{href:"/"+b.p},extend:{here:function(){d&&d.removeClass("here");a.addClass("here");d=a;c.close()}},events:{click:function(b){q(b);U(a.state.page);a.here()}}}})}var c,k={},g,f,d,h=[],l,x;g=a({events:{click:function(){L.close()}},init:function(){this.insertIn(ha).el.attr({id:"m_back"})}});
k.friends=a();h.push(k.ac=b({p:"contacts",t:"all contacts"}));h.push(k.im=b({p:"im"}));h.push(k.sc=b({p:"sc",t:"secret talks"}));h.push(k.st=b({p:"settings"}));h.push(k.ab=b({p:"about"}));h.push(k.lg=b({p:"/",t:"login"}));h.push(k.la=Za);l=k.mp=a({attrs:{"class":"u_picture"},extend:{set:function(a){this.el.css({"background-image":"url("+a+")"})}},events:{u_data:function(){if(s.userdata.crop_photo){var a=S(s.userdata.crop_photo);l.set(a)}}}});x=k.mnm=a({attrs:{"class":"inlb"},extend:{set:function(a){this.t=
a}}});var D,t=a(function(){var a;return{extend:{set:function(b){a!=b&&("bottom"==b?t.el.css({bottom:0,top:"auto"}):t.el.css({bottom:"auto",top:0}),a=b)}},initLater:function(){D!=(s.authorized?!0:!1)&&(D=s.authorized?!0:!1,f.DClist([]),D?this.parse('\n<div class="menu-items">\n<div class="center" id="my_back_line">\n{mp}\n<div class="inlb" style="vertical-align:top;">\n{mnm}<br />\n</div>\n</div>\n{ac}\n{im}\n{sc}\n{friends}\n{st}\n{ab}\n<div class="back_line center" style="padding: 5px 0;margin-top: 15px;">{la}</div>\n</div>\n',
k).insertIn(f):this.parse('\n<div class="menu-items">\n{lg}\n{ab}\n</div>\n',k).insertIn(f),c.position())}}});f=a({state:{"class":"menu"}}).insertIn(ha);var m=!1;return{state:{"class":"menu_b",html:'<div class="menu_lines" style="margin-top:10px;"></div><div class="menu_lines"></div><div class="menu_lines"></div><div class="menu_notify"></div>'},events:{click:function(){c.open("top")},u_login:function(){s.authorized?x.set(s.name):x.set("")}},
extend:{open:function(a){t.set(a);m=!0;g.addClass("m_back_show");f.addClass("menu_opened")},close:function(){m=!1;g.removeClass("m_back_show");f.removeClass("menu_opened")},toggle:function(a){m?c.close():c.open(a)},friends:function(){},position:function(){var a=I.el.crec(),b=f.el,c=b.crec();window.innerWidth>a.width+2*c.width?b.css({right:a.right-a.width-c.width}):b.css({right:0})},activate:function(a){h.find(function(b){b.state.page==a&&b.here()})},set_my_pic:function(a){l.set(a)}},init:function(){c=
this;this.insertIn(xa);t.init();s.authorized&&c.friends()}}}),Ja=a(function(){var b,c=a({state:{"class":"contextmenu",html:'\n<div class="div">\n<div class="link">text</div>\n<div class="link">app</div>\n<div class="link">text</div>\n</div>\n<div class="div">\n<div class="link">app</div>\n<div class="link">access</div>\n<div class="link">app</div>\n</div>\n<br>\n<div class="div2">\n<div class="link">link</div>\n<div class="link">option</div>\n<div class="link">one more</div>\n</div>\n<div class="div2">\n<div class="link">link text</div>\n<div class="link">option</div>\n<div class="link">improve</div>\n</div>\n'}});
return{extend:{open:function(){ga||(c.el.show(),ga=1);b&&(clearTimeout(b),c.removeClass("show_up_once"));c.addClass("show_up_once");b=setTimeout(function(){c.removeClass("show_up_once")},200);var a=c.el.crec();c.el.css({left:e.clientX-a.width/2,top:e.clientY-a.height/2})},close:function(){ga&&(ga=0,c.el.hide())}},init:function(){c.insertIn(ha)}}}),H=a({attrs:{id:"log"},extend:{is:function(a,c){c||(c=900);var k=this;this.el.show();this.t=a;k.clearTimeouts();this.timeout(function(){k.el.hide()},c)},
"long":function(a){this.is(a,2500)},until:function(a){"undefined"==typeof a?this.el.hide():(this.el.show(),this.t=a)}},init:function(){this.insertIn(ha)}}),Ka=a({state:{html:'<div class="back_line inlb" style="padding: 0 10px;margin-top: 20px;">\n<h2>MEXY.PRO</h2>\n<p>Enjoy awesomeness while interacting with others</p>\n<p>Free & Fast , Beautiful & Secure</p>\n<p>And better with time</p>\n</div>'}}),r=a(function(){function b(){F=0;n.reset();s={};D="";
E=v=m=0;K={};Q={}}function c(a){a>D&&(D=a)}function k(){h.el.scrollTop=h.el.scrollHeight}function g(a){if(!m)H.is("wrong conversation",void 0);else if("sc"!=aa){var b=a.data;G++;y("im",{act:"save",data:b,cid:m,gid:a.gid,after:D},function(a){if(a.gid&&a.mid){if(c(a.mid),r.oper({ok:1,gid:a.gid,mid:a.mid}),a.ms){var b=Q[a.mid];a.ms.reverse().forEach(function(a){n(a,b.el)});n.nameBefore(b.el)}}else H.long(a.reason)})}}function f(){F&&(ia()&&E&&m==E)&&y("im",{act:"read",cid:E,before:D},function(a){a.ok&&
(E=0)})}var d={},h,l,x,D,t,m,G=1,E,K,Q,s,la,ka=a({eltype:"audio",events:{canplaythrough:function(){ka.ready=1},tab_active:function(){this.el.pause()}},init:function(){a({eltype:"source",attrs:{src:"/other/15bells.mp3"}}).insertIn(this);this.play=function(){this.ready&&(this.el.currentTime=0,this.el.play())}}}),n=function(){var b,d,m,f,x,l,z,D,n=function(n,A){d=f=0;m="";n?n._id&&n.data&&(x=n.data,c(n._id)):(n={},f=1,x=u.el.value,u.v="");var y=!1===n.viewed;if(V(n.sender))m=" lright",d=1;else if(n.sender!=
t){Fa();return}!d&&y&&(E=n.cid);l=Ta(n.time);l!=D&&(a({state:{"class":"mdate",text:l}}).insertIn(h),D=l);var q=a({state:{"class":"l"+m}}),r=a({eltype:"span",state:{"class":"mtime",text:f?"":Ea(n.time)}});q.data.t=function(a){r.t=Ea(a)};var v=a({state:{"class":"block",text:x}});if(d){1!=b&&(b=1,z=a({state:{"class":"m_sender_name",text:"Me:"}}),z.insertIn(q));var ja;if(!1===n.viewed||f)ja=a({state:{"class":"m_unread"}}),ja.insertIn(q);r.insertIn(q);v.insertIn(q);f&&(s[G]=q,g({data:x,gid:G}))}else{if(0!=
b){b=0;var F=B(t).name.split(" ")[0];z=a({state:{"class":"m_sender_name",text:F+":"}});z.insertIn(q)}v.insertIn(q);r.insertIn(q);w.stop()}A?h.el.insertBefore(q.el,A):q.insertIn(h);n._id&&(q._id=n._id,d&&y&&(K[n._id]=q),Q[n._id]=q);q.read=function(){ja&&ja.remove()};q.pulsar=ja;w.is()?w.init():la=1;ia()||ka.play();q.addClass("appear_once");k()};n.reset=function(){b=null;D=0};n.nameBefore=function(c){1!=b&&(b=1,z=a({state:{"class":"m_sender_name",text:"Me:"}}),z.render(),c.insertBefore(z.el,c.firstChild),
k())};return n}();h=a({state:{"class":"chat"}});var v,z,u=d.in=a({eltype:"textarea",attrs:{placeholder:"Write a message","class":"inp",id:"textp"},state:{val:""},events:{input:function(a){this.value.match(/[\n\r]/g);a=Date.now();150>a-z||(w.draw({uid:V()}),z=a,!B.isOnline(t)||700>a-v||(v=a,y("typing",{uid:t})))},keydown:function(a){13!=a.keyCode||a.shiftKey||(q(a),x.onclick())}}});x=d.sbt=a({eltype:"button",state:{"class":"b",text:"\u27a4"},attrs:{id:"send"},events:{click:function(){var a=u.el,b=
a.value.trim();500<b.length&&(b=b.substr(0,500),b=b.trim());b!=a.value&&(u.v=b);a.focus();b.length&&(u.v=b,n(),w.stop(1))}}});l=a({init:function(){this.parse('\n<div class="under_chat">\n<div style="padding: 0 50px 0 51px;position: relative;">\n{in}\n<input id="attach_f" type="button" class="b" value="+">\n{sbt}\n</div>\n</div>',d)}});var w=function(){var b=a({state:{"class":"lright my_typing",html:'<div class="in_typing"></div>'}}),
c=a({state:{"class":"in_typing"}}),d=a({state:{"class":"typing_div"}}),m,g,f=0,x=0,t,l=function(){var a=b.el.crec().height,c=d.el.crec().height;a&&c<a&&(c=a);c!=m&&(k(),m=c)};return{init:function(){d.insertIn(h)},is:function(){return f||x?1:0},stop:function(a){a?f&&(g&&clearTimeout(g),b.el.remove(),l(),f=0):x&&(t&&clearTimeout(t),c.el.remove(),l(),x=0)},draw:function(a){la&&(w.init(),la=0);V(a.from)?(b.insertIn(d),g&&clearTimeout(g),f=1,g=setTimeout(function(){w.stop(1)},1800)):(c.insertIn(d),t&&
clearTimeout(t),x=1,t=setTimeout(function(){w.stop()},1800));l()}}}();return{events:{tab_active:function(){f()}},extend:{start:function(a,b){F=1;a&&(t=a.target,m=a.cid);if(b)return oa();y("user",{act:"is_online",uid:t},function(a){B.online(t,1==a);ya.draw(t);r.load();r.adapt()})},check:function(){var a=va().cid;a!=m&&(a?t?(m=a,r.start()):Wa(a,function(b,c){if(b)return Fa();r.start({cid:a,target:c})}):(ya.hide(),F=0))},adapt:function(){h.el.css({height:I.el.height()-15-xa.el.height()-l.el.height()});
k()},add:function(a){a.length&&(a.reverse().forEach(function(a){a._id>D&&n(a)}),f(),r.adapt())},load:function(){if(F&&m){var a={act:"load",cid:m};D&&(a.after=D);y("im",a,function(a){a.ok&&r.add(a.ok)})}else console.log("unable to load ms")},received:function(a){a&&m==a.cid&&r.load()},viewed:function(a){if(F&&ia()&&a.cid==m)for(var b in K)a.before<b||(K[b].read(),delete K[b])},oper:function(a){if(a.ok){if(a.gid&&a.mid){var b=a.gid;if(!s[b]){H.long("strange thing happened");return}var c;K[a.mid]=c=
s[b];Q[a.mid]=c;c._id=a.mid;c.data.t();delete s[b]}r.adapt()}},focus:function(){u.el.focus()},typing:function(a){a.from==t&&w.draw(a)},close:function(){b();ya.hide()}},initLater:function(){b();this.DClist([h,l]);h.t="";w.init();return this}}}),Ma=a(function(){var b=a({state:{html:'<div class="back_line inlb" style="margin: 20px 0;padding: 0 10px;">Or</div>'}}),c=a(),k=a(function(){var b={},c,d,g;d=b.rs=a(function(){var a;return{getSelf:function(b){a=b},extend:{is:function(b){a.t=b}},attrs:{"class":"form"}}});
g=b.em=a({eltype:"input",attrs:{"class":"inp",placeholder:"Email",type:"email",maxlength:80},events:{keydown:function(a){13==a.keyCode&&(q(a),f.onclick())}}});var f=b.bt=a({eltype:"button",attrs:{"class":"b"},state:{html:"next"},events:{click:function(a){qa(g.v)?n.busy||(n.show(void 0),v.emit("restore",{email:g.v},function(a){n.hide();a.reason?d.is(a.reason):a.ok&&d.is("Check your inbox!")}),d.is("")):(c.fail("invalid email"),g.el.focus())}}});b.btc=a({eltype:"button",attrs:{"class":"b"},state:{html:"cancel"},
events:{click:function(a){h.el.show("inline-block");c.el.hide()}}});return{extend:{fail:function(a){N(c);d.is(a)},appear:function(){c.el.show("inline-block")}},init:function(){c=this;this.parse('\n<div style="display: inline-block;" class="enter_form">\n<div class="back_line">Reset password via email:</div>\n<div style="padding-right: 22px;">\n{em}\n</div>\n{bt}{btc}\n{rs}\n</div>\n',b);this.el.hide()}}}),g=a({state:{text:"Create new password"}}),
f=a(),d=a(function(){var b={},c,g,f;g=b.rs=a(function(){var a;return{getSelf:function(b){a=b},extend:{is:function(b){a.t=b}},attrs:{"class":"form"}}});f=b.p1=a({eltype:"input",attrs:{"class":"inp",placeholder:"type new password",type:"password",maxlength:80},events:{keydown:function(a){13==a.keyCode&&(q(a),k.onclick())}}});var h=b.p2=a({eltype:"input",attrs:{"class":"inp",placeholder:"repeat password",type:"password",maxlength:80},events:{keydown:function(a){13==a.keyCode&&(q(a),k.onclick())}}}),
k=b.bt=a({eltype:"button",attrs:{"class":"b"},state:{html:"next"},events:{click:function(a){a=f.v;var b=h.v;if(!a)return f.el.focus();if(8>a.length)c.fail("invalid password"),f.el.focus();else{if(!b)return h.el.focus();b!==a?(c.fail("password mismatch"),h.el.focus()):n.busy||(n.show(void 0),v.emit("change_pass",{email:window.restore_email,key:window.restore_key,newpass:f.v},function(a){n.hide();a.reason?g.is(a.reason):a.ok&&d.DClist([Q,s])}),g.is(""))}}}}),l=b.btc=a({eltype:"button",state:{"class":"b",
html:"cancel"},events:{click:function(a){window.restore_email=!1;oa()}}}),Q=a({state:{text:"Success! Now, login with new password"}}),s=a({eltype:"button",state:{text:"ok","class":"b"},events:{click:function(){l.onclick()}}});return{extend:{fail:function(a){N(c);g.is(a)},appear:function(){c.el.show("inline-block")}},init:function(){c=this;this.parse('\n<div style="display: inline-block;" class="enter_form">\n<div class="back_line">remember it:</div>\n<div style="padding-right: 22px;">\n{p1}<br />\n{p2}\n</div>\n{bt}{btc}\n{rs}\n</div>\n',
b)}}}),h=a(function(){var b={},c,d,g,f,l;d=b.rs=a(function(){var a;return{getSelf:function(b){a=b},extend:{is:function(b){a.t=b}},attrs:{"class":"form"}}});g=b.em=a({eltype:"input",attrs:{"class":"inp",placeholder:"login",maxlength:80},events:{keydown:function(a){13==a.keyCode&&(q(a),l.onclick())}}});f=b.ps=a({eltype:"input",attrs:{"class":"inp",placeholder:"Password",type:"password",maxlength:20},events:{keydown:function(a){13==a.keyCode&&(q(a),l.onclick())}}});l=b.bt=a({eltype:"button",attrs:{"class":"b"},
state:{html:"login"},events:{click:function(a){q(a);a=g.el.value;if(4>a.length)c.fail("invalid login"),g.el.focus();else{var b=f.el.value;8>b.length?(c.fail("invalid password"),f.el.focus()):n.busy||(a={login:a,pass:b},n.show(),y("signin",a,function(a){n.hide();a.token?(R.token=a.token,location.href="/contacts"):h.fail("Nope, "+a.reason)}),d.is(""))}}}});b.ft=a({eltype:"span",state:{"class":"forgot_password",text:"restore access?"},events:{click:function(){h.el.hide();k.appear()},mousedown:function(){}}});
return{extend:{fail:function(a){N(c);d.is(a)}},init:function(){c=this;this.parse('\n<form class="enter_form">\n<div class="back_line">Sign in:</div>\n<div style="padding-right: 22px;">\n{em}<br />\n{ps}\n</div>\n{bt}\n{ft}\n{rs}\n</form>\n',b)}}}),l=a(function(){var b,c=a({eltype:"input",state:{"class":"inp"},attrs:{placeholder:"name"},events:{keydown:function(a){if(13==a.keyCode)l.onclick()},input:function(){var a=
this.value.replace(/\s/g,"").substr(0,14);a!=this.val()&&this.val(a)}}}),d=a({eltype:"input",state:{"class":"inp"},attrs:{placeholder:"last name"},events:{keydown:function(a){if(13==a.keyCode)l.onclick()},input:function(){var a=this.value.replace(/\s/g,"").substr(0,14);a!=this.val()&&this.val(a)}}}),g=a({eltype:"input",state:{"class":"inp"},attrs:{placeholder:"login"},events:{keydown:function(a){if(13==a.keyCode)l.onclick()}}}),f=a({eltype:"input",state:{"class":"inp"},attrs:{placeholder:"email"},
events:{keydown:function(a){if(13==a.keyCode)l.onclick()}}}),h=a({eltype:"input",state:{"class":"inp"},attrs:{placeholder:"password",type:"password"},events:{keydown:function(a){if(13==a.keyCode)l.onclick()}}}),l=a({eltype:"button",state:{text:"next","class":"b"},events:{click:function(){var a=c.el.value.replace(/\s/g,""),l=d.el.value.replace(/\s/g,""),n=g.el.value.trim(),z=h.el.value,u=f.el.value.trim();4>a.length?(c.el.focus(),a.length&&b.fail("wrong name")):4>l.length?(d.el.focus(),l.length&&b.fail("wrong name")):
4>u.length||!qa(u)?(f.el.focus(),u.length&&!qa(u)&&b.fail("wrong email")):4>n.length?(g.el.focus(),n.length&&b.fail("wrong login")):4>z.length?(h.el.focus(),z.length&&b.fail("wrong password")):(k.t="processing . . .",y("signup",{name:a+" "+l,login:n,email:u,pass:z},function(a){var b="";a.reason?b=b+"failed\n"+JSON.stringify(a,null,4):a.ok&&(b="Success! Check your inbox!");k.t=b}))}}}),k=a({state:{"class":"form"}});a({eltype:"button",attrs:{"class":"b"},state:{html:"next"},events:{click:function(a){qa(f.el.value)?
n.busy||k.is(""):(b.fail("invalid email"),f.el.focus())}}});var s=a({eltype:"button",state:{"class":"b",text:"register"},events:{click:function(){q.el.show("inline-block");s.el.hide()}}}),q=a().parse('\n<div style="display: inline-block;margin-bottom: 80px;" class="enter_form">\n<div class="back_line">Sign up with email:</div>\n<div style="padding-right: 22px;">\n{fn}<br />\n{sn}<br />\n{em}<br />\n{a}<br />\n{b}<br />\n{c}{d}\n</div>\n</div>',{fn:c,
sn:d,em:f,a:g,b:h,c:l,d:k});q.el.hide();return{extend:{fail:function(a){N(b);k.t=a}},init:function(){b=this;this.parse("\n<div>{a}{b}\n</div>\n",{a:s,b:q})}}});return{state:{"class":"form center"},attrs:{style:"padding-bottom: 120px;"},groups:"route",initLater:function(){ba.run(c);var a;window.restore_email&&window.restore_key?(f.h="for <b>"+window.restore_email+"</b>",a=[c,g,f,d]):a=[c,Ka,h,k,b,l];this.DClist(a);return this}}}),Na=a(function(){var b=a(function(){function c(b){b=
ea(b);var d=a(),g={},f=b._id,h,l;l='<div class="back_line"><div class="u_picture"></div>'+('<div class="inlb" style="vertical-align:top;"><div class="inlb">'+b.name+"</div><br />");f!=s.id&&(null==b.status?h="request":0==b.status?b.initiator_me?l+='<div class="green">requested</div>':h="accept":1==b.status&&(h="talk"));if(h){var k=g.bt=a({eltype:"button",attrs:{"class":"b "},state:{text:h},events:{click:function(){1!=b.status?(n.show(void 0),y("contact",{data:{target:f},type:h},function(a){n.hide();
Qa(a,function(a){"request"==h?k.replaceWith('<div class="green">requested</div>',1):k.replaceWith('<div class="green">accepted</div>',1)})})):wa(f)}}});l+="{bt}"}d.parse(l+"</div></div>",g);return d}var g,f,d,h;h=a({eltype:"input",attrs:{"class":"inp",style:"max-width:150px;",placeholder:"Type name"},extend:{fail:function(){N(h);h.el.focus()}},events:{keypress:function(a){this.value.length&&l.el.show("inline-block");if(13==a.keyCode)g.onclick(a)}}});g=a({eltype:"button",state:{"class":"b",text:"search"},
events:{click:function(a){n.busy||(a=h.el.value,3>a.length?(N(f),h.fail(),f.fail("enter more letters")):(a={name:a},f.is("searching..."),y("search",{data:a,type:"people"},function(a){n.hide();a=a.ok;var d=[],g=0;if(a&&a.length){for(var f=0;f<a.length;f++)g=a[f],d.push(c(g));b.res(d)}else b.fail()})))}}});var l=a({eltype:"button",state:{"class":"b",text:"clear"},events:{click:function(a){l.el.hide()}}});l.el.hide();f=a({attrs:{"class":"center back_line inlb",style:"padding: 5px;"},extend:{is:function(a){f.el.show("");
f.t=a},fail:function(a){N(f);h.fail();a?f.is(a):f.is("not found");d.t=""}}});var x=a({eltype:"p",state:{text:"Search for people"}}),q=a({attrs:{"class":"center back_line",style:"margin: 20px 0;padding: 1px 5px 10px;"},init:function(){this.DClist([x,h,l])}});d=a();return{extend:{res:function(a){f.is("hey, there are results:");d.t="";a.map(function(a){a.insertIn(d)})},fail:function(){f.fail()},clear:function(){f.el.hide();h.v="";d.t=""}},init:function(){this.clear();this.DClist([q,f,d]);return this}}}),
c=a(function(){var k=a({state:{"class":"contacts_list"}}),g=a(),f=a({eltype:"button",state:{"class":"b",text:"refresh"},events:{click:function(){y("contact",{act:"show_all"},function(a){a.arr&&(y("contact",{act:"show_userdata_lots",idarr:a.arr},function(a){if(a.arr)for(var b in a.arr){var c=a.arr[b];c&&c.forEach(function(a){return B.updateData(b,a)})}}),a.arr.forEach(function(a){a.status=1;a.last_v&&(a.last_v=(new Date(a.last_v)).toISOString());B.add(a._id,a);if(a.online)B.online(a._id,1)}),c.draw())});
b.clear()}}}),d=a({attrs:{"class":"center back_line inlb"},extend:{is:function(a){d.el.show();d.t=a},fail:function(a){N(d);a?d.is(a):d.is("You have no friends yet")}}});d.el.hide();var h={};return{extend:{draw:function(){var a=ea(B.getFriends());if(a){d.el.hide();for(var b in a)"length"!=b&&(h[b]||(h[b]=Ua(a[b]).insertIn(k)));for(var c in h)a=h[c],a.timer&&a.update()}else d.fail()},fail:function(){d.fail()},load:function(){f.onclick()},stop:function(){for(var a in h){var b=h[a];b.timer&&b.timer.stop()}}},
init:function(){this.DClist([d,g,k]);return this}}});return{state:{"class":"form center"},groups:"route",extend:{title:"Contacts",onleave:function(){c.stop()}},events:{u_login:function(){s.authorized&&c.load()}},initLater:function(){c.draw();this.DClist([b.init(),c]);return this}}}),Oa=a(function(){var b=a(function(){function b(a){a=a.split("_");return V()==a[1]?a[2]:a[1]}function k(d){var g=b(d.users),f=B(g);f||(f={name:"loading"},B.load(g,function(){},function(){f=B(g);k.t=f.name}));var k=a({eltype:"span",
state:{text:f.name,"class":"message_preview_name"}}),n=d.sender==V(),t=a({eltype:"span",state:{"class":"va_middle"}});t.sett=function(a){var b=a.substr(0,90);b.length!=a.length&&(b+="...");t.t=b};t.sett(d.data);var m=a({state:{"class":"u_picture_micro va_middle"},attrs:{style:"margin: 5px;"},events:{u_data:function(){my_picture.set()}}});m.set=function(){var a=S(s.userdata.crop_photo);a&&m.el.css({"background-image":"url("+a+")"})};m.set();m.visible=function(){n?m.el.show("inline-block"):m.el.hide()};
var q=a({events:{click:function(){wa(g)}}}),y=a({state:{"class":"u_picture_mid"}});q.update=function(a){f=B(g);f.userdata&&f.userdata.crop_photo&&y.el.css({"background-image":"url("+S(f.userdata.crop_photo)+")"});a&&(n=a.sender==V(),a.viewed?r.removeClass("new_message_line"):r.addClass("new_message_line"),t.sett(a.data),m.visible())};ra(g,q.update);var r=a().parse('<div class="back_line message_preview_line">{ph}<div class="inlb padl5 va_top">{a}<br />{mp}{b}</div></div>',{ph:y,a:k,b:t,mp:m}).insertIn(q);
q.update(d);return q}var g,f={};return{initLater:function(){g||(g=this);y("conv",{act:"get_list"},function(b){if(b.ok){var c=[];b.ok.forEach(function(a){var b;if(f[a.cid])return b=f[a.cid],c.push(b),b.update(a);b=k(a);f[a.cid]=b;c.push(b)});b.ok.length||c.push(a({state:{text:"you have no conversations yet","class":"center back_line"}}));g.DClist(c)}});return g}}});return{state:{},extend:{title:function(){return va().cid?!1:"Instant messages"}},groups:"route",initLater:function(){var a=[];va().cid?
a.push(r.init()):a.push(b.init());this.DClist(a);return this}}}),Pa=a(function(){var b=a({state:{html:'<div style="margin: 20px;padding: 10px;background: rgba(63, 63, 63, 0.72);">\n<p style="color:white;">Not available yet</p>\n<p style="color:white;">You can use <a href="https://temp.mexy.pro" target="_blank" style="color: #ff8282;font-weight: bold;">temp.mexy.pro</a> instead</p>\n</div>'}});a(function(){var b=a({state:{"class":"contacts_list"}}),k=a({eltype:"button",state:{"class":"b",
text:"refresh"},events:{click:function(){ba.stop();ba.run(b)}}}),g=a({attrs:{"class":"center back_line inlb"},extend:{is:function(a){g.el.show("");g.change({text:a})},fail:function(a){N(g);a?g.is(a):g.is("No friends online")}}});g.el.hide();return{extend:{draw:function(){var a=ea(P.on);b.change({html:""});var d=0;a&&a.length&&(g.el.hide(),a.map(function(a){O(a);if(a=f_get_one_u(a))f_draw_user_from_search(a).insertIn(b),d++}));d||g.fail()},fail:function(){g.fail()}},init:function(){this.DClist([g,
k,b]);return this}}});return{state:{"class":"form center"},extend:{title:"Secret talks"},groups:"route",initLater:function(){this.DClist([b]);return this}}}),Aa=DC.make(function(){var b=a(function(){function b(c){return a(function(){var a;return{getSelf:function(b){a=b},eltype:"div",state:{"class":"choose_theme choose_radio",text:c.tx},data:{theme:c.t},extend:{sel:function(){h&&h.removeClass("selected_radio");a.addClass("selected_radio");h=a;x!=l?f.el.show():f.el.hide()}},events:{click:function(b){q(b);
a.sel();da(c.t)}}}})}var c={},f,d=[],h,l,x;f=c.bt=a({eltype:"button",state:{"class":"b",text:"save"},events:{click:function(a){q(a);var b=l;b||(b="");n.show(void 0);y("settings",{prop:"theme",val:b},function(a){n.hide();a.ok&&(da(b,1),f.el.hide())})}}});f.el.hide();d.push(c.bw=b({t:"black_white_mn",tx:"black & white"}));d.push(c.dm=b({t:"dark_mn",tx:"dark colours"}));d.push(c.bm=b({t:"bright_mn",tx:"bright enough"}));d.push(c.gl=b({t:"grey_mn",tx:"grey lines"}));d.push(c.eb=b({t:"easy_blue_mn",tx:"easy blue"}));
if(!s.css)c.bw.onclick();var r=a({init:function(){this.parse('\n<div>\n<p>Select main theme:</p>\n<div class="center">\n{bw}\n{dm}\n{bm}\n{gl}\n{eb}\n</div>\n<div>{bt}</div>\n</div>\n',c)}});return{extend:{set:function(a,b){var c=Ga?"/raw_":"/";d.find(function(f){f.data.theme==a&&(Ha.el.attr("href")!=c+"css/"+s.css.theme+".css?v="+App_version&&(Ha.el.attr({href:c+
"css/"+s.css.theme+".css?v="+App_version}),l=a),b&&(x=a),f.sel())})}},init:function(){return r}}}),c=a(function(){function b(a){if(a.files&&a.files[0]){var c=new FileReader;c.onload=function(a){m.open(a.target.result)};c.readAsDataURL(a.files[0])}}var c,f=a({state:{"class":"preview_div_wrap"}}).iIn(ha),d=a({state:{"class":"preview_f_div"}}).iIn(f),h=a({state:{"class":"crop_img_wrap"}}).iIn(d),d=a().iIn(d),l=a({eltype:"button",state:{"class":"b",text:"upload"},events:{click:function(){m.upload()}}}).iIn(d);
a({eltype:"button",state:{"class":"b",text:"cancel"},events:{click:function(){m.cancel()}}}).iIn(d);var n=DC.temp({eltype:"input",attrs:{type:"file"},events:{change:function(){b(this)}}}),r=a({state:{"class":"center"}});a({state:{"class":"back_line",text:"How about your profile photo?"}}).iIn(r);var t=a({attrs:{"class":"profile_picture"},extend:{set:function(a){this.el.css({"background-image":"url("+a+")"})}},events:{u_data:function(){if(s.userdata.crop_photo){var a=S(s.userdata.crop_photo);t.set(a)}}}}).iIn(a().iIn(r));
DC.temp({eltype:"button",state:{text:"change photo","class":"b"},events:{click:function(){n.el.click()}}}).iIn(r);var m=function(){function b(a,c){var f=m.el,d=parseInt(f.css("left"))||0,g=parseInt(f.css("top"))||0,h=a.clientX-d,k=a.clientY-g;J.f||(J.f=function(b){a=c?b.changedTouches[0]:b;b=a.clientX-h;var d=a.clientY-k,g=f.crec();0>b&&(b=0);0>d&&(d=0);b+g.width>v.width&&(b=v.width-g.width);d+g.height>v.height&&(d=v.height-g.height);f.css({left:b,top:d})})}function d(a,b){var c=m.el,f=c.crec(),g=
parseInt(c.css("left"))||0,h=parseInt(c.css("top"))||0,k=300*(v.width/v.naturalWidth),l=a.clientX,n=a.clientY;J.f||(J.f=function(d){a=b?d.changedTouches[0]:d;d=a.clientX-l+f.width;var m=a.clientY-n+f.height;d<k&&(d=k);m<k&&(m=k);g+d>v.width&&(d=v.width-g);m>v.height-h&&(m=v.height-h);d<m&&(m=d);m<d&&(d=m);c.css({width:d,height:m})})}function k(a){if(c){var b=a.arr;0==a.cur&&(a.total=b.length);var d=a.cur,f=a.total;d==f?"crop"==a.type?(r.t="saving crop photo...",y("save_crop_photo",{loid:a.loid},function(a){a.crop_photo&&
(s.userdata.crop_photo=a.crop_photo,DC.emit("u_data"));r.t="done!";l.el.show("inline-block");B.cancel()})):"orig"==a.type&&(r.t="saving photo...",y("save_photo",{loid:a.loid},function(a){r.t="cropping photo...";B.crop(function(a){c=a;B.upload({type:"crop"})})})):y("upload",{bin:b[d],loid:a.loid},function(b){b&&b.reason?console.log("error happened"):(console.log("packet",d,"uploaded"),a.cur++,r.t="uploading... "+Math.floor(100*(d/f))+"%",k(a))})}}var m=a({state:{"class":"crop_img_border"},events:{mousedown:function(a){q(a);
b(a)},touchstart:function(a){q(a);ta=1;b(a.changedTouches[0],1)}}}).iIn(h);a({state:{"class":"crop_img_resize"},events:{mousedown:function(a){q(a);d(a)},touchstart:function(a){q(a);ta=1;d(a.changedTouches[0],1)}}}).iIn(m);var t=a({eltype:"img",state:{"class":"img_preview"}}).iIn(h),r=a({state:{"class":"back_line"}}).iIn(h),v=t.el;v.onload=function(){c=v.src;if(300>v.naturalWidth||300>v.naturalHeight)H.is("too liitle image",void 0),B.cancel()};var B={open:function(a){5E6<a.length?H.is("too large photo",
void 0):(t.el.src=a,m.el.css({left:0,top:0,width:100,height:100}),f.el.show(),l.el.show("inline-block"),r.t="")},cancel:function(){t.src="";n.v="";c=!1;f.el.hide()}},D=document.createElement("canvas");D.width=D.height=300;B.crop=function(a){var b=m.el,c=t.el,d=c.width/c.naturalWidth,f=b.crec().width/d;300>f&&(f=300);var g=parseInt(b.css("left"))||0,h=parseInt(b.css("top"))||0,k=D.getContext("2d"),l=new Image;l.onload=function(){k.drawImage(l,g/d,h/d,f,f,0,0,300,300);a(D.toDataURL())};l.src=c.src};
B.upload=function(){var a=0<arguments.length&&void 0!==arguments[0]?arguments[0]:{};if(!c)return r.t="empty file data";fetch(c).then(function(a){return a.blob()}).then(function(b){console.log(b);if(4E6<b.size)return r.t="too large file";for(var c=[],d=0,f=Math.floor(b.size/4E4);d<=f;d++)c.push(b.slice(4E4*d,4E4*d+4E4));l.el.hide();b=k;d="";for(f=0;3>f;f++)d+="0123456789abcdefghijklmnopqrstuvwxyzABCDEFGHIJKLMNOPQRSTUVWXYZ"[Math.floor(62*Math.random())];b({arr:c,cur:0,loid:d,type:a.type||"orig"})})};
B.cancel();return B}();return{extend:{set:function(a){}},init:function(){return r}}});return{state:{"class":"form"},extend:{title:"Settings",theme:b,profile_photo:c},groups:"route",initLater:function(){this.DClist([b.init(),c.init()]);return this}}}),za=a(function(){var b=a({state:{html:'<div class="back_line inlb" style="margin: 20px 0;padding: 0 10px;">MEXY.PRO is all you need to interact with others in this world</div>'}}),c=a();return{state:{"class":"form center"},extend:{title:"About"},groups:"route",
initLater:function(){ba.run(c);this.DClist([c,b,Ka]);return this}}});window.onpopstate=function(){U(location.pathname.substr(1),0)};DC.onwindow("resize",function(){Da();F&&r.adapt()});!function(){var a,c,k,g=!1;document.createElement("div").addEventListener("test",function(){},{get passive(){g=!0;return!1}});window.addEventListener("touchstart",function(f){var d=f.changedTouches[0];c=d.clientX;k=d.clientY;g||q(f);a=1},g?{passive:!0}:!1);window.addEventListener("touchmove",function(f){if(ta)J.f&&J.f(f);
else{var d=f.changedTouches[0],h=d.clientX,d=d.clientY;a&&(g||q(f),35<Math.abs(h-c)?(L.toggle("bottom"),a=0):15<Math.abs(d-k)&&(a=0))}},g?{passive:!0}:!1);DC.onwindow("touchend",function(f){ta=a=c=0;J={}})}();DC.onwindow("mousedown",function(a){2==a.button?sa=[a.clientX,a.clientY]:ga&&Ja.close()});DC.onwindow("mousemove",function(a){J.f&&J.f(a)});DC.onwindow("mouseup",function(){J={}});DC.onwindow("contextmenu",function(a){if(sa){var c=sa;sa=0;var k=a.clientX,g=c[0]-k,f=c[1]-a.clientY;if(144<g*g+
f*f)return Ja.close(),12<k-c[0]?history.forward():12<c[0]-k&&history.back(),q(a)}a.ctrlKey||3!=a.which||(q(a),L.toggle())});DC.onwindow("keydown",function(a){a.altKey&&(q(a),L.toggle());F&&(a=String.fromCharCode(a.keyCode),/[\u0430-\u044f\u0451a-z0-9-_!-+ )]/i.test(a)&&r.focus())});!function(){var a="mexy.pro"===location.hostname,c=a?8443:location.port;a&&"https:"!=location.protocol&&(location.protocol="https:");v=io((a?"mexy-lepta.rhcloud.com":"")+":"+c,{transports:["websocket"],reconnectionAttempts:5})}();
H.until("connecting...");v.on("connect",function(){H.until();ma=1;n.hide();v.sendBuffer=[];Ca()}).on("disconnect",function(a){ma=0;pa("u_login")}).on("app_local_mode",function(a){Ga=1}).on("error",function(a){H.until("socket error")});da();Da();n.show("initialize...");ia(Ia);Ia()});
